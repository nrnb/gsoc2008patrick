<?xml version="1.0"?>
<!--
	Random Networks Ant Build Script.
	Author:  Patrick J. McSweeney (pjmcswee@gmail.com)
-->

<project name="RandomNetworks" default="all" basedir=".">

    <!-- The build directory -->
    <!-- All files generated by ant go here -->
    <property name="build"    value="${basedir}/build"/>

    <!-- The java source directory-->
    <property name="src"      value="${basedir}/src"/>

    <!-- The dist directory -->
    <property name="dist"    value="${basedir}/plugins"/>


    <!-- The cytoscape directory -->
    <property name="cytoscape"    value="../../cytoscape"/>


    <!-- The lib directory -->
    <!-- Contains all third-party JAR files, required for compilation -->
    <!-- property name="lib"       value="${cytoscape}/lib"/> -->
    <property name="junit"       value="${cytoscape}/lib}"/>

    <!-- The testData directory -->
    <property name="testData"    value="${cytoscape}/testData"/>


	<!--  ============ Compilation Control Options ======================= -->
  	<property name="compile.debug"       value="true"/>
  	<property name="compile.deprecation" value="true"/>
  	<property name="compile.optimize"    value="true"/>

	
	<!-- ==================== Compilation Classpath ====================== -->
    <!--
        NB:  Compilation classpath assumes that main cytoscape project is checked out,
        and compiled.
    -->
    <path id="compile.classpath">
		<pathelement path="${build}/classes"/>
		<fileset dir="${cytoscape}">
				<include name="cytoscape.jar"/>
         </fileset>
  	</path>

    <!-- ==================== Clean Target =============================== -->
    <target name="clean"
        description="Deletes all build files and starts fresh">
        <delete dir="${build}"/>
        <delete dir="${dist}"/>
        <delete file="${basedir}/RandomNetworks.jar"/>
    </target>



 <!-- ==================== Compile Target ============================= -->
    <target name="checkcompile" depends="prepare"
        description="Compiles all Java source files">
        <mkdir dir="${build}/classes"/>
        <javac srcdir="${src}"
		    source="1.5"
            destdir="build/classes"
            debug="${compile.debug}"
            deprecation="${compile.deprecation}"
            optimize="${compile.optimize}">
        <classpath refid="compile.classpath"/>
		<compilerarg value="-Xlint"/> 
        </javac>
    </target>


    <!-- ==================== Compile Target ============================= -->
    <target name="compile" depends="prepare"
        description="Compiles all Java source files">
        <mkdir dir="${build}/classes"/>
        <javac srcdir="${src}"
		    source="1.5"
            destdir="build/classes"
            debug="${compile.debug}"
            deprecation="${compile.deprecation}"
            optimize="${compile.optimize}">
        <classpath refid="compile.classpath"/>
        </javac>
    </target>

    <!-- ==================== Jar Target ================================= -->
    <target name="jar" depends="compile"
            description="Creates Plugin Jar: RandomNetworks.jar">
        <copy file="${basedir}/plugin.props" todir="${build}/classes/cytoscape/randomnetwork/" />
        <jar destfile="${basedir}/RandomNetworks.jar"
             basedir="${build}/classes">
	    	<manifest>
	     		<attribute name="Cytoscape-Plugin" 
		           value="cytoscape.randomnetwork.RandomNetworkPlugin"/>
	     	</manifest>
		</jar>
        <copy todir="${cytoscape}/plugins/core">
            <fileset file="${basedir}/RandomNetworks.jar"/>
        </copy>
    </target>





    <!-- ==================== Run Target ================================= -->
    <target depends="jar"
		description="Runs Latest Version of Cytoscape with RandmoNetworks Plugin"
        name="run">
        <java classname="cytoscape.CyMain" classpathref="compile.classpath"
            fork="true" maxmemory="1000M">
            <arg line="-N ${testData}/galFiltered.sif -p ${cytoscape}/plugins/core"/>
        </java>
    </target>

	<!-- ==================== Build jar and run ========================== -->
    <target name="cjar" depends="clean, jar"/>



	<!-- ==================== Build jar and run ========================== -->
    <target name="all" depends="clean, jar, run"/>


	<!-- ==================== Prepare Target ============================= -->
    <target name="prepare">
        <!-- Create build directories as needed -->
        <mkdir  dir="${build}"/>
        <mkdir  dir="${build}/classes"/>
    </target>


    <!-- ==================== JUnit Test Target =========================== -->
    <target name="test" description="Runs all JUnit tests" depends="compile">
            <junit printsummary="yes" fork="yes" haltonfailure="yes">
            <formatter type="plain" usefile="false"/>
            <test name="cytoscape.randomnetwork.RandomNetworkTests"/>
            <classpath refid="compile.classpath"/>
        </junit>
    </target>
	
</project>
